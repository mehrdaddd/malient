import * as tslib_1 from "tslib";
import * as React from 'react';
import { Component } from 'react';
import { Card, CardView, } from '@atlaskit/media-card';
import { withImageLoader, } from '@atlaskit/editor-common';
var MediaCardInternal = /** @class */ (function (_super) {
    tslib_1.__extends(MediaCardInternal, _super);
    function MediaCardInternal() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.state = {};
        return _this;
    }
    MediaCardInternal.prototype.componentDidMount = function () {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var mediaProvider, provider, context;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        mediaProvider = this.props.mediaProvider;
                        if (!mediaProvider) {
                            return [2 /*return*/];
                        }
                        return [4 /*yield*/, mediaProvider];
                    case 1:
                        provider = _a.sent();
                        return [4 /*yield*/, provider.viewContext];
                    case 2:
                        context = _a.sent();
                        this.setState({
                            context: context,
                        });
                        return [2 /*return*/];
                }
            });
        });
    };
    MediaCardInternal.prototype.renderExternal = function () {
        var _a = this.props, cardDimensions = _a.cardDimensions, resizeMode = _a.resizeMode, appearance = _a.appearance, url = _a.url, imageStatus = _a.imageStatus, disableOverlay = _a.disableOverlay;
        return (React.createElement(CardView, { status: imageStatus || 'loading', dataURI: url, dimensions: cardDimensions, metadata: {
                mediaType: 'image',
                name: url,
            }, appearance: appearance, resizeMode: resizeMode, disableOverlay: disableOverlay }));
    };
    MediaCardInternal.prototype.render = function () {
        var context = this.state.context;
        var _a = this.props, eventHandlers = _a.eventHandlers, id = _a.id, type = _a.type, collection = _a.collection, cardDimensions = _a.cardDimensions, resizeMode = _a.resizeMode, appearance = _a.appearance, disableOverlay = _a.disableOverlay;
        if (type === 'external') {
            return this.renderExternal();
        }
        if (!context) {
            return (React.createElement(CardView, { status: "loading", mediaItemType: type, dimensions: cardDimensions }));
        }
        var identifier = {
            id: id,
            mediaItemType: type,
            collectionName: collection,
        };
        return (React.createElement(Card, { identifier: identifier, context: context, dimensions: cardDimensions, onClick: eventHandlers && eventHandlers.media && eventHandlers.media.onClick, resizeMode: resizeMode, appearance: appearance, disableOverlay: disableOverlay }));
    };
    return MediaCardInternal;
}(Component));
export { MediaCardInternal };
export var MediaCard = withImageLoader(MediaCardInternal);
//# sourceMappingURL=MediaCard.js.map