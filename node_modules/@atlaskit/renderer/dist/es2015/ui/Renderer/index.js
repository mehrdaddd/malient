import * as tslib_1 from "tslib";
import * as React from 'react';
import { PureComponent } from 'react';
import { UnsupportedBlock, ProviderFactory, defaultSchema, } from '@atlaskit/editor-common';
import { ReactSerializer, renderDocument } from '../../';
import { Wrapper } from './style';
var Renderer = /** @class */ (function (_super) {
    tslib_1.__extends(Renderer, _super);
    function Renderer(props) {
        var _this = _super.call(this, props) || this;
        _this.providerFactory = props.dataProviders || new ProviderFactory();
        _this.updateSerializer(props);
        return _this;
    }
    Renderer.prototype.componentWillReceiveProps = function (nextProps) {
        if (nextProps.portal !== this.props.portal) {
            this.updateSerializer(nextProps);
        }
    };
    Renderer.prototype.updateSerializer = function (props) {
        var eventHandlers = props.eventHandlers, portal = props.portal, rendererContext = props.rendererContext, document = props.document, extensionHandlers = props.extensionHandlers, schema = props.schema, useNewApplicationCard = props.useNewApplicationCard;
        this.serializer = new ReactSerializer({
            providers: this.providerFactory,
            eventHandlers: eventHandlers,
            extensionHandlers: extensionHandlers,
            portal: portal,
            objectContext: tslib_1.__assign({ adDoc: document, schema: schema }, rendererContext),
            useNewApplicationCard: useNewApplicationCard,
        });
    };
    Renderer.prototype.render = function () {
        var _a = this.props, document = _a.document, onComplete = _a.onComplete, schema = _a.schema, appearance = _a.appearance, adfStage = _a.adfStage;
        try {
            var _b = renderDocument(document, this.serializer, schema || defaultSchema, adfStage), result = _b.result, stat = _b.stat;
            if (onComplete) {
                onComplete(stat);
            }
            return React.createElement(Wrapper, { appearance: appearance }, result);
        }
        catch (ex) {
            return (React.createElement(Wrapper, { appearance: appearance },
                React.createElement(UnsupportedBlock, null)));
        }
    };
    Renderer.prototype.componentWillUnmount = function () {
        var dataProviders = this.props.dataProviders;
        // if this is the ProviderFactory which was created in constructor
        // it's safe to destroy it on Renderer unmount
        if (!dataProviders) {
            this.providerFactory.destroy();
        }
    };
    return Renderer;
}(PureComponent));
export default Renderer;
//# sourceMappingURL=index.js.map