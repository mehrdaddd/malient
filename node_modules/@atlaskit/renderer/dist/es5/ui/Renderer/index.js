"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var React = require("react");
var react_1 = require("react");
var editor_common_1 = require("@atlaskit/editor-common");
var _1 = require("../../");
var style_1 = require("./style");
var Renderer = /** @class */ (function (_super) {
    tslib_1.__extends(Renderer, _super);
    function Renderer(props) {
        var _this = _super.call(this, props) || this;
        _this.providerFactory = props.dataProviders || new editor_common_1.ProviderFactory();
        _this.updateSerializer(props);
        return _this;
    }
    Renderer.prototype.componentWillReceiveProps = function (nextProps) {
        if (nextProps.portal !== this.props.portal) {
            this.updateSerializer(nextProps);
        }
    };
    Renderer.prototype.updateSerializer = function (props) {
        var eventHandlers = props.eventHandlers, portal = props.portal, rendererContext = props.rendererContext, document = props.document, extensionHandlers = props.extensionHandlers, schema = props.schema, useNewApplicationCard = props.useNewApplicationCard;
        this.serializer = new _1.ReactSerializer({
            providers: this.providerFactory,
            eventHandlers: eventHandlers,
            extensionHandlers: extensionHandlers,
            portal: portal,
            objectContext: tslib_1.__assign({ adDoc: document, schema: schema }, rendererContext),
            useNewApplicationCard: useNewApplicationCard,
        });
    };
    Renderer.prototype.render = function () {
        var _a = this.props, document = _a.document, onComplete = _a.onComplete, schema = _a.schema, appearance = _a.appearance, adfStage = _a.adfStage;
        try {
            var _b = _1.renderDocument(document, this.serializer, schema || editor_common_1.defaultSchema, adfStage), result = _b.result, stat = _b.stat;
            if (onComplete) {
                onComplete(stat);
            }
            return React.createElement(style_1.Wrapper, { appearance: appearance }, result);
        }
        catch (ex) {
            return (React.createElement(style_1.Wrapper, { appearance: appearance },
                React.createElement(editor_common_1.UnsupportedBlock, null)));
        }
    };
    Renderer.prototype.componentWillUnmount = function () {
        var dataProviders = this.props.dataProviders;
        // if this is the ProviderFactory which was created in constructor
        // it's safe to destroy it on Renderer unmount
        if (!dataProviders) {
            this.providerFactory.destroy();
        }
    };
    return Renderer;
}(react_1.PureComponent));
exports.default = Renderer;
//# sourceMappingURL=index.js.map