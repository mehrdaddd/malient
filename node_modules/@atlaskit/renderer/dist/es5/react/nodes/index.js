"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var applicationCard_1 = require("./applicationCard");
exports.ApplicationCard = applicationCard_1.default;
var blockquote_1 = require("./blockquote");
exports.Blockquote = blockquote_1.default;
var bodiedExtension_1 = require("./bodiedExtension");
exports.BodiedExtension = bodiedExtension_1.default;
var bulletList_1 = require("./bulletList");
exports.BulletList = bulletList_1.default;
var codeBlock_1 = require("./codeBlock");
exports.CodeBlock = codeBlock_1.default;
var decisionItem_1 = require("./decisionItem");
exports.DecisionItem = decisionItem_1.default;
var decisionList_1 = require("./decisionList");
exports.DecisionList = decisionList_1.default;
var doc_1 = require("./doc");
exports.Doc = doc_1.default;
var emoji_1 = require("./emoji");
exports.Emoji = emoji_1.default;
var extension_1 = require("./extension");
exports.Extension = extension_1.default;
var hardBreak_1 = require("./hardBreak");
exports.HardBreak = hardBreak_1.default;
var heading_1 = require("./heading");
exports.Heading = heading_1.default;
var image_1 = require("./image");
exports.Image = image_1.default;
var inlineExtension_1 = require("./inlineExtension");
exports.InlineExtension = inlineExtension_1.default;
var listItem_1 = require("./listItem");
exports.ListItem = listItem_1.default;
var media_1 = require("./media");
exports.Media = media_1.default;
var mediaGroup_1 = require("./mediaGroup");
exports.MediaGroup = mediaGroup_1.default;
var mediaSingle_1 = require("./mediaSingle");
exports.MediaSingle = mediaSingle_1.default;
exports.BreakoutProvider = mediaSingle_1.BreakoutProvider;
var mention_1 = require("./mention");
exports.Mention = mention_1.default;
var orderedList_1 = require("./orderedList");
exports.OrderedList = orderedList_1.default;
var panel_1 = require("./panel");
exports.Panel = panel_1.default;
var paragraph_1 = require("./paragraph");
exports.Paragraph = paragraph_1.default;
var placeholder_1 = require("./placeholder");
exports.Placeholder = placeholder_1.default;
var rule_1 = require("./rule");
exports.Rule = rule_1.default;
var taskItem_1 = require("./taskItem");
exports.TaskItem = taskItem_1.default;
var taskList_1 = require("./taskList");
exports.TaskList = taskList_1.default;
var table_1 = require("./table");
exports.Table = table_1.default;
var tableCell_1 = require("./tableCell");
exports.TableCell = tableCell_1.default;
var tableHeader_1 = require("./tableHeader");
exports.TableHeader = tableHeader_1.default;
var tableRow_1 = require("./tableRow");
exports.TableRow = tableRow_1.default;
var unknownBlock_1 = require("./unknownBlock");
exports.UnknownBlock = unknownBlock_1.default;
var utils_1 = require("../../utils");
exports.nodeToReact = {
    applicationCard: applicationCard_1.default,
    blockquote: blockquote_1.default,
    bulletList: bulletList_1.default,
    codeBlock: codeBlock_1.default,
    decisionItem: decisionItem_1.default,
    decisionList: decisionList_1.default,
    doc: doc_1.default,
    emoji: emoji_1.default,
    extension: extension_1.default,
    bodiedExtension: bodiedExtension_1.default,
    hardBreak: hardBreak_1.default,
    heading: heading_1.default,
    image: image_1.default,
    inlineExtension: inlineExtension_1.default,
    listItem: listItem_1.default,
    media: media_1.default,
    mediaGroup: mediaGroup_1.default,
    mediaSingle: mediaSingle_1.default,
    mention: mention_1.default,
    orderedList: orderedList_1.default,
    panel: panel_1.default,
    paragraph: paragraph_1.default,
    placeholder: placeholder_1.default,
    rule: rule_1.default,
    taskItem: taskItem_1.default,
    taskList: taskList_1.default,
    table: table_1.default,
    tableCell: tableCell_1.default,
    tableHeader: tableHeader_1.default,
    tableRow: tableRow_1.default,
    unknownBlock: unknownBlock_1.default,
};
exports.toReact = function (node) {
    return exports.nodeToReact[node.type.name];
};
/*
 *  Wraps adjacent textnodes in a textWrapper
 *
 *  Input:
 *  [
 *    {
 *      type: 'text',
 *      text: 'Hello'
 *    },
 *    {
 *      type: 'text',
 *      text: 'World!',
 *      marks: [
 *        {
 *          type: 'strong'
 *        }
 *      ]
 *    }
 *  ]
 *
 *  Output:
 *  [
 *    {
 *      type: 'textWrapper',
 *      content: [
 *        {
 *          type: 'text',
 *          text: 'Hello'
 *        },
 *        {
 *          type: 'text',
 *          text: 'World!',
 *          marks: [
 *            {
 *              type: 'strong'
 *            }
 *          ]
 *        }
 *      ]
 *    }
 *  ]
 */
exports.mergeTextNodes = function (nodes) {
    return nodes.reduce(function (acc, current) {
        if (!exports.isText(current.type.name)) {
            acc.push(current);
            return acc;
        }
        // Append node to previous node, if it was a text wrapper
        if (acc.length > 0 && exports.isTextWrapper(acc[acc.length - 1].type.name)) {
            acc[acc.length - 1].content.push(current);
        }
        else {
            acc.push({
                type: {
                    name: 'textWrapper',
                },
                content: [current],
            });
        }
        return acc;
    }, []);
};
exports.isText = function (type) {
    return type === 'text';
};
exports.isTextWrapper = function (type) {
    return type === 'textWrapper';
};
var whitespaceRegex = /^\s*$/;
/**
 * Detects whether a fragment contains a single paragraph node
 * whose content satisfies the condition for an emoji block
 */
exports.isEmojiDoc = function (doc, props) {
    if (props === void 0) { props = {}; }
    // Previously calculated to be true so pass prop down
    // from paragraph node to emoji node
    if (props.fitToHeight === utils_1.bigEmojiHeight) {
        return true;
    }
    if (doc.childCount !== 1) {
        return false;
    }
    var parentNodes = [];
    doc.forEach(function (child) { return parentNodes.push(child); });
    var node = parentNodes[0];
    return node.type.name === 'paragraph' && isEmojiBlock(node.content);
};
var isEmojiBlock = function (pnode) {
    var content = [];
    // Optimisation for long documents - worst case block will be space-emoji-space
    if (pnode.childCount > 7) {
        return false;
    }
    pnode.forEach(function (child) { return content.push(child); });
    var emojiCount = 0;
    for (var i = 0; i < content.length; ++i) {
        var node = content[i];
        switch (node.type.name) {
            case 'text':
                if (node.text && !node.text.match(whitespaceRegex)) {
                    return false;
                }
                continue;
            case 'emoji':
                if (++emojiCount > 3) {
                    return false;
                }
                continue;
            default:
                // Only text and emoji nodes are allowed
                return false;
        }
    }
    return emojiCount > 0;
};
//# sourceMappingURL=index.js.map