"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var React = require("react");
var avatar_1 = require("@atlaskit/avatar");
var lozenge_1 = require("@atlaskit/lozenge");
var lock_circle_1 = require("@atlaskit/icon/glyph/lock-circle");
var tooltip_1 = require("@atlaskit/tooltip");
var util_shared_styles_1 = require("@atlaskit/util-shared-styles");
var types_1 = require("../../types");
var mouse_1 = require("../../util/mouse");
var styles_1 = require("./styles");
// tslint:disable:next-line variable-name
function renderHighlight(ReactComponent, value, highlights, prefix) {
    if (!value) {
        return null;
    }
    var parts = [];
    var prefixText = prefix || '';
    var lastIndex = 0;
    if (highlights) {
        for (var i = 0; i < highlights.length; i++) {
            var h = highlights[i];
            var start = h.start;
            var end = h.end;
            if (start > lastIndex) {
                parts.push({
                    value: value.substring(lastIndex, start),
                    matches: false,
                });
            }
            parts.push({
                value: value.substring(start, end + 1),
                matches: true,
            });
            lastIndex = end + 1;
        }
        if (lastIndex < value.length) {
            parts.push({
                value: value.substring(lastIndex, value.length),
                matches: false,
            });
        }
    }
    else {
        parts.push({
            value: value,
            matches: false,
        });
    }
    return (React.createElement(ReactComponent, null,
        prefixText,
        parts.map(function (part, index) {
            if (part.matches) {
                return React.createElement("b", { key: index }, part.value);
            }
            return part.value;
        })));
}
function renderLozenge(lozenge) {
    if (lozenge) {
        return React.createElement(lozenge_1.default, null, lozenge);
    }
    return null;
}
function renderTime(time) {
    if (time) {
        return React.createElement(styles_1.TimeStyle, null, time);
    }
    return null;
}
var MentionItem = /** @class */ (function (_super) {
    tslib_1.__extends(MentionItem, _super);
    function MentionItem() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        // internal, used for callbacks
        _this.onMentionSelected = function (event) {
            if (mouse_1.leftClick(event) && _this.props.onSelection) {
                event.preventDefault();
                _this.props.onSelection(_this.props.mention, event);
            }
        };
        _this.onMentionMenuItemMouseMove = function (event) {
            if (_this.props.onMouseMove) {
                _this.props.onMouseMove(_this.props.mention, event);
            }
        };
        return _this;
    }
    MentionItem.prototype.render = function () {
        var _a = this.props, mention = _a.mention, selected = _a.selected;
        var id = mention.id, highlight = mention.highlight, avatarUrl = mention.avatarUrl, presence = mention.presence, name = mention.name, mentionName = mention.mentionName, nickname = mention.nickname, lozenge = mention.lozenge, accessLevel = mention.accessLevel;
        var _b = presence || {}, status = _b.status, time = _b.time;
        var restricted = types_1.isRestricted(accessLevel);
        var nameHighlights = highlight && highlight.name;
        var nicknameHighlights = highlight && highlight.nickname;
        var borderColor = selected ? util_shared_styles_1.akColorN30 : undefined;
        return (React.createElement(styles_1.MentionItemStyle, { selected: selected, onMouseDown: this.onMentionSelected, onMouseMove: this.onMentionMenuItemMouseMove, "data-mention-id": id, "data-mention-name": mentionName },
            React.createElement(styles_1.RowStyle, null,
                React.createElement(styles_1.AvatarStyle, { restricted: restricted },
                    React.createElement(avatar_1.default, { src: avatarUrl, size: "medium", presence: status, borderColor: borderColor })),
                React.createElement(styles_1.NameSectionStyle, { restricted: restricted },
                    renderHighlight(styles_1.FullNameStyle, name, nameHighlights),
                    renderHighlight(styles_1.NicknameStyle, nickname, nicknameHighlights, '@')),
                React.createElement(styles_1.InfoSectionStyle, { restricted: restricted },
                    renderLozenge(lozenge),
                    renderTime(time)),
                restricted ? (React.createElement(tooltip_1.default, { content: name + " won't be notified as they have no access", position: "right" },
                    React.createElement(styles_1.AccessSectionStyle, null,
                        React.createElement(lock_circle_1.default, { label: "No access" })))) : null)));
    };
    return MentionItem;
}(React.PureComponent));
exports.default = MentionItem;
//# sourceMappingURL=index.js.map