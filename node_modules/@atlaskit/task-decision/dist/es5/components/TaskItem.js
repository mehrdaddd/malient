"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var React = require("react");
var react_1 = require("react");
var TaskItem_1 = require("../styled/TaskItem");
var Item_1 = require("./Item");
var analytics_1 = require("@atlaskit/analytics");
var taskCount = 0;
var getCheckBoxId = function (localId) { return localId + "-" + taskCount++; };
var InternalTaskItem = /** @class */ (function (_super) {
    tslib_1.__extends(InternalTaskItem, _super);
    function InternalTaskItem(props) {
        var _this = _super.call(this, props) || this;
        _this.handleOnChange = function (evt) {
            var _a = _this.props, onChange = _a.onChange, taskId = _a.taskId, isDone = _a.isDone, fireAnalyticsEvent = _a.fireAnalyticsEvent, firePrivateAnalyticsEvent = _a.firePrivateAnalyticsEvent;
            var newIsDone = !isDone;
            if (onChange) {
                onChange(taskId, newIsDone);
            }
            var suffix = newIsDone ? 'check' : 'uncheck';
            if (fireAnalyticsEvent) {
                fireAnalyticsEvent(suffix, {});
            }
            if (firePrivateAnalyticsEvent) {
                firePrivateAnalyticsEvent("atlassian.fabric.action." + suffix, {});
            }
        };
        _this.checkBoxId = getCheckBoxId(props.taskId);
        return _this;
    }
    InternalTaskItem.prototype.componentWillReceiveProps = function (nextProps) {
        if (nextProps.taskId !== this.props.taskId) {
            this.checkBoxId = getCheckBoxId(nextProps.taskId);
        }
    };
    InternalTaskItem.prototype.getAttributionText = function () {
        var _a = this.props, creator = _a.creator, lastUpdater = _a.lastUpdater, isDone = _a.isDone;
        if (isDone && lastUpdater) {
            return "Completed by " + lastUpdater.displayName;
        }
        if (!creator || !creator.displayName) {
            return undefined;
        }
        return "Added by " + creator.displayName;
    };
    InternalTaskItem.prototype.render = function () {
        var _a = this.props, appearance = _a.appearance, isDone = _a.isDone, contentRef = _a.contentRef, children = _a.children, participants = _a.participants, showPlaceholder = _a.showPlaceholder;
        var icon = (React.createElement(TaskItem_1.CheckBoxWrapper, { contentEditable: false },
            React.createElement("input", { id: this.checkBoxId, name: this.checkBoxId, type: "checkbox", onChange: this.handleOnChange, checked: !!isDone }),
            React.createElement("label", { htmlFor: this.checkBoxId })));
        return (React.createElement(Item_1.default, { appearance: appearance, contentRef: contentRef, icon: icon, participants: participants, placeholder: "Type your action, use '@' to assign to someone.", showPlaceholder: showPlaceholder, attribution: this.getAttributionText() }, children));
    };
    InternalTaskItem.defaultProps = {
        appearance: 'inline',
    };
    return InternalTaskItem;
}(react_1.PureComponent));
exports.InternalTaskItem = InternalTaskItem;
// This is to ensure that the "type" is exported, as it gets lost and not exported along with TaskItem after
// going through the high order component.
// tslint:disable-next-line:variable-name
var TaskItem = analytics_1.withAnalytics(InternalTaskItem, {}, { analyticsId: 'atlassian.fabric.action' });
exports.default = TaskItem;
//# sourceMappingURL=TaskItem.js.map