"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var React = require("react");
var media_wrap_left_1 = require("@atlaskit/icon/glyph/editor/media-wrap-left");
var media_wrap_right_1 = require("@atlaskit/icon/glyph/editor/media-wrap-right");
var media_center_1 = require("@atlaskit/icon/glyph/editor/media-center");
var media_wide_1 = require("@atlaskit/icon/glyph/editor/media-wide");
var media_full_width_1 = require("@atlaskit/icon/glyph/editor/media-full-width");
var remove_1 = require("@atlaskit/icon/glyph/editor/remove");
var editor_common_1 = require("@atlaskit/editor-common");
var ToolbarButton_1 = require("../../../../ui/ToolbarButton");
var Separator_1 = require("../../../../ui/Separator");
var FloatingToolbar_1 = require("../../../../ui/FloatingToolbar");
var utils_1 = require("../../../../utils");
var icons = {
    'wrap-left': {
        icon: media_wrap_left_1.default,
        label: 'wrap left',
    },
    center: {
        icon: media_center_1.default,
        label: 'center',
    },
    'wrap-right': {
        icon: media_wrap_right_1.default,
        label: 'wrap right',
    },
    wide: {
        icon: media_wide_1.default,
        label: 'wide',
    },
    'full-width': {
        icon: media_full_width_1.default,
        label: 'full width',
    },
};
var MediaSingleEdit = /** @class */ (function (_super) {
    tslib_1.__extends(MediaSingleEdit, _super);
    function MediaSingleEdit() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.state = { layout: 'center', allowBreakout: true, allowLayout: true };
        _this.handleRemove = function () {
            var pluginState = _this.props.pluginState;
            pluginState.removeSelectedMediaNode();
        };
        _this.handlePluginStateChange = function (pluginState) {
            var target = pluginState.element, layout = pluginState.layout;
            var node = pluginState.selectedMediaNode();
            var allowBreakout = !!(node &&
                node.attrs &&
                node.attrs.width > editor_common_1.akEditorFullPageMaxWidth);
            var allowLayout = !!pluginState.isLayoutSupported();
            _this.setState({ target: target, layout: layout, allowBreakout: allowBreakout, allowLayout: allowLayout });
        };
        return _this;
    }
    MediaSingleEdit.prototype.componentDidMount = function () {
        this.props.pluginState.subscribe(this.handlePluginStateChange);
    };
    MediaSingleEdit.prototype.componentWillUnmount = function () {
        this.props.pluginState.unsubscribe(this.handlePluginStateChange);
    };
    MediaSingleEdit.prototype.render = function () {
        var _this = this;
        var _a = this.state, target = _a.target, selectedLayout = _a.layout, allowBreakout = _a.allowBreakout, allowLayout = _a.allowLayout;
        if (target &&
            !utils_1.closestElement(target, 'li') &&
            !utils_1.closestElement(target, 'table')) {
            return (React.createElement(FloatingToolbar_1.default, { target: target, offset: [0, 3], fitHeight: 24 },
                Object.keys(icons).map(function (layout, index) {
                    // Don't render Wide and Full width button for image smaller than editor content width
                    if (index > 2 && !allowBreakout) {
                        return;
                    }
                    var Icon = icons[layout].icon;
                    var label = icons[layout].label;
                    return (
                    /** Adding extra span tag here to get rid of unnecessary styling */
                    React.createElement("span", { key: index },
                        React.createElement(ToolbarButton_1.default, { disabled: !allowLayout, selected: layout === selectedLayout, onClick: _this.handleChangeLayout.bind(_this, layout), iconBefore: React.createElement(Icon, { label: "Change layout to " + label }) })));
                }),
                React.createElement(Separator_1.default, null),
                React.createElement("span", null,
                    React.createElement(ToolbarButton_1.default, { onClick: this.handleRemove, iconBefore: React.createElement(remove_1.default, { label: "Remove media" }) }))));
        }
        else {
            return null;
        }
    };
    MediaSingleEdit.prototype.handleChangeLayout = function (layout) {
        this.props.pluginState.align(layout);
    };
    return MediaSingleEdit;
}(React.Component));
exports.default = MediaSingleEdit;
//# sourceMappingURL=index.js.map