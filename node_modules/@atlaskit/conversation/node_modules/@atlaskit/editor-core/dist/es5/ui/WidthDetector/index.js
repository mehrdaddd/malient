"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var React = require("react");
var react_1 = require("react");
var size_detector_1 = require("@atlaskit/size-detector");
var width_1 = require("../../plugins/width");
var WidthDetector = /** @class */ (function (_super) {
    tslib_1.__extends(WidthDetector, _super);
    function WidthDetector() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.debounce = null;
        _this.broadcastWidth = function (width) {
            var editorView = _this.props.editorView;
            if (editorView && _this.width !== width) {
                if (_this.debounce) {
                    clearTimeout(_this.debounce);
                }
                // NodeViews will trigger multiple state change error without this debounce
                _this.debounce = setTimeout(function () {
                    var tr = editorView.state.tr.setMeta(width_1.pluginKey, width);
                    tr.setMeta('isLocal', true);
                    editorView.dispatch(tr);
                    _this.width = width;
                    _this.debounce = null;
                }, 10);
            }
        };
        return _this;
    }
    WidthDetector.prototype.render = function () {
        var _this = this;
        return (React.createElement(size_detector_1.default, { containerStyle: {
                height: 0,
                width: '100%',
                flex: 'none',
            } }, function (_a) {
            var width = _a.width;
            return _this.broadcastWidth(width) || null;
        }));
    };
    return WidthDetector;
}(react_1.Component));
exports.default = WidthDetector;
//# sourceMappingURL=index.js.map