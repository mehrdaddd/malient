"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var prosemirror_state_1 = require("prosemirror-state");
var analytics_1 = require("../../../analytics");
var filter_1 = require("../../../utils/filter");
var clipboard = require("../../../utils/clipboard");
exports.stateKey = new prosemirror_state_1.PluginKey('tasksAndDecisionsPlugin');
function createPlugin() {
    return new prosemirror_state_1.Plugin({
        props: {
            handlePaste: function (view, event, slice) {
                if (!event.clipboardData) {
                    return false;
                }
                var _a = view.state, selection = _a.selection, schema = _a.schema;
                var nodes = schema.nodes;
                var decisionList = nodes.decisionList, decisionItem = nodes.decisionItem, taskList = nodes.taskList, taskItem = nodes.taskItem;
                if ((!decisionItem || !decisionList) && (!taskList || !taskItem)) {
                    return false;
                }
                // Bail if copied content has files
                if (clipboard.isPastedFile(event)) {
                    return true;
                }
                var $from = selection.$from, $to = selection.$to;
                // Delegate to default paste if selection is a range
                if ($from.pos !== $to.pos) {
                    return false;
                }
                var nodeType = $from.node($from.depth).type;
                if (nodeType !== decisionItem && nodeType !== taskItem) {
                    // Not an action or decision, exit early
                    return false;
                }
                analytics_1.analyticsService.trackEvent('atlassian.fabric.action-decision.editor.paste');
                var tr = view.state.tr.replaceSelection(filter_1.taskDecisionSliceFilter(slice, schema));
                view.dispatch(tr.scrollIntoView());
                return true;
            },
        },
        key: exports.stateKey,
    });
}
exports.default = createPlugin;
//# sourceMappingURL=paste-plugin.js.map