import * as tslib_1 from "tslib";
import * as React from 'react';
import styled from 'styled-components';
import WrapLeftIcon from '@atlaskit/icon/glyph/editor/media-wrap-left';
import WrapRightIcon from '@atlaskit/icon/glyph/editor/media-wrap-right';
import CenterIcon from '@atlaskit/icon/glyph/editor/media-center';
import WideIcon from '@atlaskit/icon/glyph/editor/media-wide';
import FullWidthIcon from '@atlaskit/icon/glyph/editor/media-full-width';
import RemoveIcon from '@atlaskit/icon/glyph/editor/remove';
import { akEditorFullPageMaxWidth, } from '@atlaskit/editor-common';
import { akColorN70, akColorR300, akColorR400, } from '@atlaskit/util-shared-styles';
import UiToolbarButton from '../../../../ui/ToolbarButton';
import UiSeparator from '../../../../ui/Separator';
import UiFloatingToolbar from '../../../../ui/FloatingToolbar';
import { closestElement } from '../../../../utils';
var icons = {
    'wrap-left': {
        icon: WrapLeftIcon,
        label: 'Align left',
    },
    center: {
        icon: CenterIcon,
        label: 'Align center',
    },
    'wrap-right': {
        icon: WrapRightIcon,
        label: 'Align right',
    },
    wide: {
        icon: WideIcon,
        label: 'Wide',
    },
    'full-width': {
        icon: FullWidthIcon,
        label: 'Full width',
    },
};
var ToolbarButton = styled(UiToolbarButton)(templateObject_1 || (templateObject_1 = tslib_1.__makeTemplateObject(["\n  width: 24px;\n  padding: 0;\n  margin: 0 2px;\n"], ["\n  width: 24px;\n  padding: 0;\n  margin: 0 2px;\n"])));
var Separator = styled(UiSeparator)(templateObject_2 || (templateObject_2 = tslib_1.__makeTemplateObject(["\n  margin: 2px 6px;\n"], ["\n  margin: 2px 6px;\n"])));
// `line-height: 1` to fix extra 1px height from toolbar wrapper
var FloatingToolbar = styled(UiFloatingToolbar)(templateObject_3 || (templateObject_3 = tslib_1.__makeTemplateObject(["\n  & > div {\n    line-height: 1;\n  }\n  & > div:first-child > button {\n    margin-left: 0;\n  }\n  & > div:last-child > button {\n    margin-right: 0;\n  }\n"], ["\n  & > div {\n    line-height: 1;\n  }\n  & > div:first-child > button {\n    margin-left: 0;\n  }\n  & > div:last-child > button {\n    margin-right: 0;\n  }\n"])));
var ToolbarButtonDestructive = styled(ToolbarButton)(templateObject_4 || (templateObject_4 = tslib_1.__makeTemplateObject(["\n  &:hover {\n    color: ", " !important;\n  }\n  &:active {\n    color: ", " !important;\n  }\n  &[disabled]:hover {\n    color: ", " !important;\n  }\n"], ["\n  &:hover {\n    color: ", " !important;\n  }\n  &:active {\n    color: ", " !important;\n  }\n  &[disabled]:hover {\n    color: ", " !important;\n  }\n"])), akColorR300, akColorR400, akColorN70);
var MediaSingleEdit = /** @class */ (function (_super) {
    tslib_1.__extends(MediaSingleEdit, _super);
    function MediaSingleEdit() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.state = { layout: 'center', allowBreakout: true, allowLayout: true };
        _this.handleRemove = function () {
            var pluginState = _this.props.pluginState;
            pluginState.removeSelectedMediaNode();
        };
        _this.handlePluginStateChange = function (pluginState) {
            var target = pluginState.element, layout = pluginState.layout;
            var node = pluginState.selectedMediaNode();
            var allowBreakout = !!(node &&
                node.attrs &&
                node.attrs.width > akEditorFullPageMaxWidth);
            var allowLayout = !!pluginState.isLayoutSupported();
            _this.setState({ target: target, layout: layout, allowBreakout: allowBreakout, allowLayout: allowLayout });
        };
        return _this;
    }
    MediaSingleEdit.prototype.componentDidMount = function () {
        this.props.pluginState.subscribe(this.handlePluginStateChange);
    };
    MediaSingleEdit.prototype.componentWillUnmount = function () {
        this.props.pluginState.unsubscribe(this.handlePluginStateChange);
    };
    MediaSingleEdit.prototype.render = function () {
        var _this = this;
        var _a = this.state, target = _a.target, selectedLayout = _a.layout, allowBreakout = _a.allowBreakout, allowLayout = _a.allowLayout;
        if (target &&
            !closestElement(target, 'li') &&
            !closestElement(target, 'table')) {
            return (React.createElement(FloatingToolbar, { target: target, offset: [0, 12], fitHeight: 32 },
                Object.keys(icons).map(function (layout, index) {
                    // Don't render Wide and Full width button for image smaller than editor content width
                    if (index > 2 && !allowBreakout) {
                        return;
                    }
                    var Icon = icons[layout].icon;
                    var label = icons[layout].label;
                    return (React.createElement(ToolbarButton, { spacing: "compact", key: index, disabled: !allowLayout, selected: layout === selectedLayout, onClick: _this.handleChangeLayout.bind(_this, layout), title: label, iconBefore: React.createElement(Icon, { label: "Change layout to " + label }) }));
                }),
                React.createElement(Separator, null),
                React.createElement(ToolbarButtonDestructive, { spacing: "compact", onClick: this.handleRemove, title: "Remove image", iconBefore: React.createElement(RemoveIcon, { label: "Remove image" }) })));
        }
        else {
            return null;
        }
    };
    MediaSingleEdit.prototype.handleChangeLayout = function (layout) {
        this.props.pluginState.align(layout);
    };
    return MediaSingleEdit;
}(React.Component));
export default MediaSingleEdit;
var templateObject_1, templateObject_2, templateObject_3, templateObject_4;
//# sourceMappingURL=index.js.map