"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var actions_1 = require("../actions");
var getFilesInRecents_1 = require("../actions/getFilesInRecents");
exports.getFilesInRecents = function (fetcher) { return function (store) { return function (next) { return function (action) {
    var userAuthProvider = store.getState().userAuthProvider;
    if (getFilesInRecents_1.isGetFilesInRecentsAction(action)) {
        exports.requestRecentFiles(fetcher, userAuthProvider, store);
    }
    return next(action);
}; }; }; };
exports.requestRecentFiles = function (fetcher, userAuthProvider, store) {
    var apiUrl = store.getState().apiUrl;
    return userAuthProvider()
        .then(function (auth) { return fetcher.getRecentFiles(apiUrl, auth, 30, 'desc'); })
        .then(function (_a) {
        var contents = _a.contents, nextInclusiveStartKey = _a.nextInclusiveStartKey;
        store.dispatch(actions_1.getFilesInRecentsFullfilled(contents, nextInclusiveStartKey));
    })
        .catch(function () {
        store.dispatch(actions_1.getFilesInRecentsFailed());
    });
};
//# sourceMappingURL=getFilesInRecents.js.map