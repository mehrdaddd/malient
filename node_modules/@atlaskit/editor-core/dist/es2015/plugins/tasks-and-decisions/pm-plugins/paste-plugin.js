import { Plugin, PluginKey } from 'prosemirror-state';
import { analyticsService } from '../../../analytics';
import { taskDecisionSliceFilter } from '../../../utils/filter';
import * as clipboard from '../../../utils/clipboard';
export var stateKey = new PluginKey('tasksAndDecisionsPlugin');
export default function createPlugin() {
    return new Plugin({
        props: {
            handlePaste: function (view, event, slice) {
                if (!event.clipboardData) {
                    return false;
                }
                var _a = view.state, selection = _a.selection, schema = _a.schema;
                var nodes = schema.nodes;
                var decisionList = nodes.decisionList, decisionItem = nodes.decisionItem, taskList = nodes.taskList, taskItem = nodes.taskItem;
                if ((!decisionItem || !decisionList) && (!taskList || !taskItem)) {
                    return false;
                }
                // Bail if copied content has files
                if (clipboard.isPastedFile(event)) {
                    return true;
                }
                var $from = selection.$from, $to = selection.$to;
                // Delegate to default paste if selection is a range
                if ($from.pos !== $to.pos) {
                    return false;
                }
                var nodeType = $from.node($from.depth).type;
                if (nodeType !== decisionItem && nodeType !== taskItem) {
                    // Not an action or decision, exit early
                    return false;
                }
                analyticsService.trackEvent('atlassian.fabric.action-decision.editor.paste');
                var tr = view.state.tr.replaceSelection(taskDecisionSliceFilter(slice, schema));
                view.dispatch(tr.scrollIntoView());
                return true;
            },
        },
        key: stateKey,
    });
}
//# sourceMappingURL=paste-plugin.js.map