import * as tslib_1 from "tslib";
import styled from 'styled-components';
import { Component } from 'react';
import * as React from 'react';
import { Popup, tableBackgroundColorPalette, tableBackgroundBorderColors, } from '@atlaskit/editor-common';
import RemoveIcon from '@atlaskit/icon/glyph/editor/remove';
import FullWidthIcon from '@atlaskit/icon/glyph/editor/media-full-width';
import WideIcon from '@atlaskit/icon/glyph/editor/media-wide';
import CenterIcon from '@atlaskit/icon/glyph/editor/media-center';
import { ToolbarButton, ToolbarButtonDanger, Separator } from './styles';
import AdvanceMenu from './AdvanceMenu';
import BackgroundColorMenu from './BackgroundColorMenu';
import DisplayOptionsMenu from './DisplayOptionsMenu';
import { hoverTable, clearHoverTable } from '../../actions';
// `Popup` doesn't work with -ve `offset` if it goes outside of the container hence the -ve margin
export var Toolbar = styled.div(templateObject_1 || (templateObject_1 = tslib_1.__makeTemplateObject(["\n  margin-top: -8px;\n  background-color: white;\n  border-radius: 3px;\n  box-shadow: rgba(9, 30, 66, 0.31) 0 0 1px,\n    rgba(9, 30, 66, 0.25) 0 4px 8px -2px;\n  padding: 4px 8px;\n  display: flex;\n\n  & > div:last-child button {\n    margin-right: 0;\n  }\n  & > div:first-child button {\n    margin-left: 0;\n  }\n"], ["\n  margin-top: -8px;\n  background-color: white;\n  border-radius: 3px;\n  box-shadow: rgba(9, 30, 66, 0.31) 0 0 1px,\n    rgba(9, 30, 66, 0.25) 0 4px 8px -2px;\n  padding: 4px 8px;\n  display: flex;\n\n  & > div:last-child button {\n    margin-right: 0;\n  }\n  & > div:first-child button {\n    margin-left: 0;\n  }\n"])));
var tableLayouts = {
    default: {
        icon: CenterIcon,
        label: 'inline',
    },
    wide: {
        icon: WideIcon,
        label: 'wide',
    },
    'full-width': {
        icon: FullWidthIcon,
        label: 'full width',
    },
};
var TableFloatingToolbar = /** @class */ (function (_super) {
    tslib_1.__extends(TableFloatingToolbar, _super);
    function TableFloatingToolbar() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.state = {
            isOpen: false,
        };
        _this.setTableinDanger = function () {
            var _a = _this.props.editorView, state = _a.state, dispatch = _a.dispatch;
            hoverTable(true)(state, dispatch);
        };
        _this.resetTableinDanger = function () {
            var _a = _this.props.editorView, state = _a.state, dispatch = _a.dispatch;
            clearHoverTable(state, dispatch);
        };
        _this.removeTable = function () {
            var _a = _this.props, _b = _a.editorView, state = _b.state, dispatch = _b.dispatch, removeTable = _a.removeTable;
            clearHoverTable(state, dispatch);
            removeTable();
        };
        return _this;
    }
    TableFloatingToolbar.prototype.render = function () {
        var _this = this;
        var _a = this.props, popupsMountPoint = _a.popupsMountPoint, popupsBoundariesElement = _a.popupsBoundariesElement, popupsScrollableElement = _a.popupsScrollableElement, tableElement = _a.tableElement, editorView = _a.editorView, allowMergeCells = _a.allowMergeCells, tableActive = _a.tableActive, tableLayout = _a.tableLayout, allowNumberColumn = _a.allowNumberColumn, allowBackgroundColor = _a.allowBackgroundColor, allowHeaderRow = _a.allowHeaderRow, allowHeaderColumn = _a.allowHeaderColumn, stickToolbarToBottom = _a.stickToolbarToBottom, isLayoutSupported = _a.isLayoutSupported;
        if (!tableElement || !tableActive) {
            return null;
        }
        var availableLayouts = [];
        if (this.props.permittedLayouts) {
            if (this.props.permittedLayouts === 'all') {
                availableLayouts = Object.keys(tableLayouts);
            }
            else {
                availableLayouts = this.props.permittedLayouts;
            }
        }
        var shouldDisableLayout = isLayoutSupported
            ? !isLayoutSupported()
            : false;
        var layoutButtons = Array.from(new Set(availableLayouts)).map(function (layoutName) {
            var label = "Change layout to " + tableLayouts[layoutName].label;
            var Icon = tableLayouts[layoutName].icon;
            var onClick = function () {
                _this.props.updateLayout(layoutName);
            };
            return (React.createElement(ToolbarButton, { spacing: "compact", disabled: shouldDisableLayout, selected: tableLayout === layoutName, onClick: _this.props.updateLayout ? onClick : undefined, title: label, key: layoutName, iconBefore: React.createElement(Icon, { label: label }) }));
        });
        return (React.createElement(Popup, { offset: [0, 20], target: tableElement, mountTo: popupsMountPoint, boundariesElement: popupsBoundariesElement, scrollableElement: popupsScrollableElement, stickToBottom: stickToolbarToBottom, alignY: "bottom", alignX: "center", ariaLabel: "Table floating controls" },
            React.createElement(Toolbar, null,
                allowBackgroundColor && (React.createElement(BackgroundColorMenu, { editorView: editorView, palette: tableBackgroundColorPalette, mountPoint: popupsMountPoint, borderColors: tableBackgroundBorderColors })),
                (allowNumberColumn || allowHeaderRow || allowHeaderColumn) && (React.createElement(DisplayOptionsMenu, { editorView: editorView, mountPoint: popupsMountPoint, allowNumberColumn: allowNumberColumn, allowHeaderRow: allowHeaderRow, allowHeaderColumn: allowHeaderColumn })),
                allowMergeCells && (React.createElement(AdvanceMenu, { editorView: editorView, mountPoint: popupsMountPoint, allowMergeCells: allowMergeCells })),
                (allowBackgroundColor ||
                    allowNumberColumn ||
                    allowHeaderRow ||
                    allowHeaderColumn ||
                    allowMergeCells) && React.createElement(Separator, { style: { height: 'auto' } }),
                layoutButtons,
                layoutButtons.length ? (React.createElement(Separator, { style: { height: 'auto' } })) : null,
                React.createElement("div", { onMouseEnter: this.setTableinDanger, onMouseLeave: this.resetTableinDanger },
                    React.createElement(ToolbarButtonDanger, { spacing: "compact", onClick: this.removeTable, title: "Remove table", iconBefore: React.createElement(RemoveIcon, { label: "Remove table" }) })))));
    };
    return TableFloatingToolbar;
}(Component));
export default TableFloatingToolbar;
var templateObject_1;
//# sourceMappingURL=index.js.map