"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var prosemirror_view_1 = require("prosemirror-view");
var util_shared_styles_1 = require("@atlaskit/util-shared-styles");
var editor_common_1 = require("@atlaskit/editor-common");
exports.colors = [
    util_shared_styles_1.akColorR400,
    util_shared_styles_1.akColorY400,
    util_shared_styles_1.akColorG400,
    util_shared_styles_1.akColorT400,
    util_shared_styles_1.akColorB400,
    util_shared_styles_1.akColorP400,
    util_shared_styles_1.akColorN800,
].map(function (solid) { return ({
    solid: solid,
    selection: editor_common_1.hexToRgba(solid, 0.2),
}); });
// tslint:disable:no-bitwise
exports.getAvatarColor = function (str) {
    var hash = 0;
    for (var i = 0; i < str.length; i++) {
        hash = (hash << 5) - hash + str.charCodeAt(i);
        hash = hash & hash;
    }
    var index = Math.abs(hash) % exports.colors.length;
    return { index: index, color: exports.colors[index] };
};
// tslint:enable:no-bitwise
exports.findPointers = function (id, decorations) {
    return decorations
        .find()
        .reduce(function (arr, deco) {
        return deco.spec.pointer.sessionId === id ? arr.concat(deco) : arr;
    }, []);
};
function style(options) {
    var color = (options && options.color) || 'black';
    return "border-left: 1px solid " + color + "; border-right: 1px solid " + color + "; margin-right: -2px;";
}
exports.createTelepointers = function (from, to, sessionId, isSelection, initial) {
    var decorations = [];
    var avatarColor = exports.getAvatarColor(sessionId);
    var color = avatarColor.index.toString();
    if (isSelection) {
        var className = "telepointer color-" + color + " telepointer-selection";
        decorations.push(prosemirror_view_1.Decoration.inline(from, to, { class: className, 'data-initial': initial }, { pointer: { sessionId: sessionId } }));
    }
    var cursor = document.createElement('span');
    cursor.textContent = '\u200b';
    cursor.className = "telepointer color-" + color + " telepointer-selection-badge";
    cursor.style.cssText = style({ color: avatarColor.color.solid }) + ";";
    cursor.setAttribute('data-initial', initial);
    return decorations.concat(prosemirror_view_1.Decoration.widget(to, cursor, { pointer: { sessionId: sessionId } }));
};
//# sourceMappingURL=utils.js.map