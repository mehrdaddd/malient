import { Node as PMNode, Schema, Node } from 'prosemirror-model';
import { EditorView } from 'prosemirror-view';
import { EditorState, Plugin, PluginKey, Transaction } from 'prosemirror-state';
import { MediaType, MediaSingleLayout } from '@atlaskit/editor-common';
import { Dispatch } from '../../../event-dispatcher';
import { ProsemirrorGetPosHandler } from '../../../nodeviews';
import { EditorAppearance } from '../../../types/editor-props';
import { MediaPluginOptions } from '../media-plugin-options';
import { URLInfo } from '../utils/media-links';
import PickerFacade from '../picker-facade';
import { MediaState, MediaProvider, MediaStateStatus, MediaStateManager } from '../types';
import DefaultMediaStateManager from '../default-state-manager';
export { DefaultMediaStateManager };
export { MediaState, MediaProvider, MediaStateStatus, MediaStateManager };
export declare type PluginStateChangeSubscriber = (state: MediaPluginState) => any;
export interface MediaNodeWithPosHandler {
    node: PMNode;
    getPos: ProsemirrorGetPosHandler;
}
export declare class MediaPluginState {
    allowsMedia: boolean;
    allowsUploads: boolean;
    allowsLinks: boolean;
    stateManager: MediaStateManager;
    ignoreLinks: boolean;
    waitForMediaUpload: boolean;
    allUploadsFinished: boolean;
    showDropzone: boolean;
    element?: HTMLElement;
    layout: MediaSingleLayout;
    private mediaNodes;
    private pendingTask;
    private options;
    private view;
    private pluginStateChangeSubscribers;
    private useDefaultStateManager;
    private destroyed;
    private mediaProvider;
    private errorReporter;
    pickers: PickerFacade[];
    binaryPicker?: PickerFacade;
    private popupPicker?;
    private clipboardPicker?;
    private dropzonePicker?;
    private customPicker?;
    private linkRanges;
    editorAppearance: EditorAppearance;
    private removeOnCloseListener;
    constructor(state: EditorState, options: MediaPluginOptions, editorAppearance?: EditorAppearance);
    subscribe(cb: PluginStateChangeSubscriber): void;
    unsubscribe(cb: PluginStateChangeSubscriber): void;
    setMediaProvider: (mediaProvider?: Promise<MediaProvider> | undefined) => Promise<void>;
    updateElement(): void;
    updateUploadStateDebounce: number | null;
    updateUploadState(): void;
    updateLayout(layout: MediaSingleLayout): void;
    private isMediaSingle();
    private getDomElement(docView);
    insertFile: (mediaState: MediaState) => void;
    insertFiles: (mediaStates: MediaState[]) => void;
    insertLinks: () => Promise<(string | undefined)[] | undefined>;
    splitMediaGroup: () => boolean;
    insertFileFromDataUrl: (url: string, fileName: string) => void;
    onPopupPickerClose: () => void;
    showMediaPicker: () => void;
    /**
     * Returns a promise that is resolved after all pending operations have been finished.
     * An optional timeout will cause the promise to reject if the operation takes too long
     *
     * NOTE: The promise will resolve even if some of the media have failed to process.
     */
    waitForPendingTasks: (timeout?: Number | undefined, lastTask?: Promise<MediaState | null> | undefined) => any;
    setView(view: EditorView): void;
    /**
     * Called from React UI Component when user clicks on "Delete" icon
     * inside of it
     */
    handleMediaNodeRemoval: (node: PMNode, getPos: ProsemirrorGetPosHandler) => void;
    /**
     * This is called when media node is removed from media group node view
     */
    cancelInFlightUpload(id: string): void;
    /**
     * Called from React UI Component on componentDidMount
     */
    handleMediaNodeMount: (node: PMNode, getPos: ProsemirrorGetPosHandler) => void;
    /**
     * Called from React UI Component on componentWillUnmount and componentWillReceiveProps
     * when React component's underlying node property is replaced with a new node
     */
    handleMediaNodeUnmount: (oldNode: PMNode) => void;
    align: (layout: MediaSingleLayout) => boolean;
    destroy(): void;
    findMediaNode: (id: string) => MediaNodeWithPosHandler | null;
    detectLinkRangesInSteps: (tr: Transaction, oldState: EditorState) => URLInfo[] | undefined;
    private destroyPickers;
    private initPickers(uploadParams, context, Picker);
    private trackNewMediaEvent(pickerType);
    private collectionFromProvider();
    private handleMediaState;
    private notifyPluginStateSubscribers;
    nodeHasNoPublicId: (state: MediaState) => any;
    removeNodeById: (id: string) => void;
    private replaceTemporaryNode;
    removeSelectedMediaNode: () => boolean;
    selectedMediaNode(): Node | undefined;
    isLayoutSupported(): boolean;
    /**
     * Since we replace nodes with public id when node is finalized
     * stateManager contains no information for public ids
     */
    private getMediaNodeStateStatus;
    getMediaNodeState: (id: string) => MediaState | undefined;
    private handleDrag;
}
export declare const stateKey: PluginKey;
export declare const getMediaPluginState: (state: EditorState) => MediaPluginState;
export declare const createPlugin: (schema: Schema, options: MediaPluginOptions, dispatch?: Dispatch<any> | undefined, editorAppearance?: EditorAppearance) => Plugin;
export interface MediaData {
    id: string;
    type?: MediaType;
}
