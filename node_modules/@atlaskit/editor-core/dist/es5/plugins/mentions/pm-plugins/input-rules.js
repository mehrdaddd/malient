"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var prosemirror_inputrules_1 = require("prosemirror-inputrules");
var input_rules_1 = require("../../../utils/input-rules");
var analytics_1 = require("../../../analytics");
var main_1 = require("./main");
function inputRulePlugin(schema) {
    var rules = [];
    if (schema.nodes.mention && schema.marks.mentionQuery) {
        var regex = new RegExp("(^|[\\s(" + input_rules_1.leafNodeReplacementCharacter + "])@$");
        var mentionQueryRule = input_rules_1.createInputRule(regex, function (state, match, start, end) {
            var mentionsState = main_1.mentionPluginKey.getState(state);
            if (!mentionsState.mentionProvider) {
                return undefined;
            }
            if (!mentionsState.isEnabled()) {
                return undefined;
            }
            var mark = schema.mark('mentionQuery');
            var tr = state.tr;
            analytics_1.analyticsService.trackEvent('atlassian.fabric.mention.picker.trigger.shortcut');
            var mentionText = schema.text('@', [mark]);
            return tr.replaceSelectionWith(mentionText, false);
        });
        rules.push(mentionQueryRule);
    }
    if (rules.length !== 0) {
        return prosemirror_inputrules_1.inputRules({ rules: rules });
    }
}
exports.inputRulePlugin = inputRulePlugin;
exports.default = inputRulePlugin;
//# sourceMappingURL=input-rules.js.map